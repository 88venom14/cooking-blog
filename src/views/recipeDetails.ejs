<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <link rel="stylesheet" href="/css/style.css" />
  <title><%= recipe.title %></title>
</head>
<body>
  <div class="page">

    <h1><%= recipe.title %></h1>

    <p>
      –ê–≤—Ç–æ—Ä:
      <% if (recipe.author) { %>
        <a href="/profile/<%= recipe.author.id %>">
          <%= recipe.author.username %>
        </a>
      <% } else { %>
        –ê–Ω–æ–Ω–∏–º
      <% } %>
    </p>

    <p>–ö–∞—Ç–µ–≥–æ—Ä–∏—è: <%= recipe.category.name %></p>
    <p>–°–ª–æ–∂–Ω–æ—Å—Ç—å: <%= recipe.difficulty %></p>

    <hr>
      <% if (recipe.imageUrl) { %>
        <img src="<%= recipe.imageUrl %>" alt="<%= recipe.title %>" class="detail-image">
      <% } %>

    <p><%= recipe.content %></p>

    <hr>
      <div class="reactions">
        <form method="POST" action="/recipes/<%= recipe.id %>/react" class="reaction-form">
          <button type="submit" name="type" value="like" 
                  class="reaction-btn <%= userReactionType === 'like' ? 'active' : '' %>">
            üëç <span class="count"><%= reactionCounts.like %></span>
          </button>
        </form>

        <form method="POST" action="/recipes/<%= recipe.id %>/react" class="reaction-form">
          <button type="submit" name="type" value="heart" 
                  class="reaction-btn <%= userReactionType === 'heart' ? 'active' : '' %>">
            ‚ù§Ô∏è <span class="count"><%= reactionCounts.heart %></span>
          </button>
        </form>

        <form method="POST" action="/recipes/<%= recipe.id %>/react" class="reaction-form">
          <button type="submit" name="type" value="fire" 
                  class="reaction-btn <%= userReactionType === 'fire' ? 'active' : '' %>">
            üî• <span class="count"><%= reactionCounts.fire %></span>
          </button>
        </form>

        <!-- –ù–æ–≤—ã–µ —Ä–µ–∞–∫—Ü–∏–∏ -->
        <form method="POST" action="/recipes/<%= recipe.id %>/react" class="reaction-form">
          <button type="submit" name="type" value="dislike" 
                  class="reaction-btn <%= userReactionType === 'dislike' ? 'active' : '' %>">
            üëé <span class="count"><%= reactionCounts.dislike %></span>
          </button>
        </form>

        <form method="POST" action="/recipes/<%= recipe.id %>/react" class="reaction-form">
          <button type="submit" name="type" value="poop" 
                  class="reaction-btn <%= userReactionType === 'poop' ? 'active' : '' %>">
            üí© <span class="count"><%= reactionCounts.poop %></span>
          </button>
        </form>
      </div>

      <p class="total-reactions">
        –í—Å–µ–≥–æ —Ä–µ–∞–∫—Ü–∏–π: <%= Object.values(reactionCounts).reduce((a, b) => a + b, 0) %>
      </p>

    <hr><h2>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏</h2>

    <% recipe.comments.forEach(comment => { %>
      <div style="margin-bottom: 1rem;">
        <strong>
          <%= comment.isAnonymous ? "–ê–Ω–æ–Ω–∏–º" : comment.author?.username %>
        </strong>
        <p><%= comment.text %></p>
      </div>
    <% }) %>

    <hr>

    <!-- –§–æ—Ä–º–∞ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è -->
    <% if (isAuthenticated) { %>  <!-- –ò–∑–º–µ–Ω–µ–Ω–æ: if (isAuthenticated) -->
      <form method="POST" action="/recipes/<%= recipe.id %>/comment">
        <textarea name="text" required></textarea>

        <label>
          <input type="checkbox" name="anonymous" />
          –û—Å—Ç–∞–≤–∏—Ç—å –∞–Ω–æ–Ω–∏–º–Ω–æ
        </label>

        <button type="submit">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
      </form>
    <% } else { %>
      <p>–ß—Ç–æ–±—ã –æ—Å—Ç–∞–≤–∏—Ç—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π, <a href="/auth/login">–≤–æ–π–¥–∏—Ç–µ –≤ –∞–∫–∫–∞—É–Ω—Ç</a>.</p>
    <% } %>

    <a href="/recipes">‚Üê –ù–∞–∑–∞–¥</a>

  </div>
  <!-- –í–†–ï–ú–ï–ù–ù–ê–Ø –û–¢–õ–ê–î–ö–ê -->
<p style="font-size:11px; color:#888; margin-top:30px;">
  –û—Ç–ª–∞–¥–∫–∞: isAuthenticated = <%= isAuthenticated %> | 
  session.userId = <%= typeof req !== 'undefined' ? '–¥–∞' : '–Ω–µ—Ç' %>
</p>
</body>
</html>
